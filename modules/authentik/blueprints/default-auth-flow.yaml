version: 1
metadata:
  name: Default Authentication Flow
  description: Ensure the default authentication flow with Identification, Password and User Login stages

entries:
  - id: default-auth-flow
    model: authentik_flows.flow
    identifiers:
      slug: default-authentication-flow
    attrs:
      name: Default Authentication
      slug: default-authentication-flow
      designation: authentication
      title: "Sign in"

  - id: stage-identification
    model: authentik_stages_identification.identificationstage
    identifiers:
      name: Default Identification
    attrs:
      name: Default Identification
      user_fields:
        - email
        - username

  - id: stage-password
    model: authentik_stages_password.passwordstage
    identifiers:
      name: Default Password
    attrs:
      name: Default Password
      backends:
        - authentik.core.auth.InbuiltBackend

  - id: stage-login
    model: authentik_stages_user_login.userloginstage
    identifiers:
      name: Default User Login
    attrs:
      name: Default User Login

  - id: binding-identification
    model: authentik_flows.flowstagebinding
    identifiers:
      target: !KeyOf default-auth-flow
      stage: !KeyOf stage-identification
    attrs:
      target: !KeyOf default-auth-flow
      stage: !KeyOf stage-identification
      order: 0

  - id: binding-password
    model: authentik_flows.flowstagebinding
    identifiers:
      target: !KeyOf default-auth-flow
      stage: !KeyOf stage-password
    attrs:
      target: !KeyOf default-auth-flow
      stage: !KeyOf stage-password
      order: 1

  - id: binding-login
    model: authentik_flows.flowstagebinding
    identifiers:
      target: !KeyOf default-auth-flow
      stage: !KeyOf stage-login
    attrs:
      target: !KeyOf default-auth-flow
      stage: !KeyOf stage-login
      order: 2


